<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;700&display=swap" rel="stylesheet">
  <style>
    <?!= include('Style'); ?>  /* Mantener todos los estilos que ya ten√≠as */
  </style>
</head>
<body>
  <div class="container">
    <div class="banner-container" style="background-image: url('https://i.imgur.com/EPlOPin.jpeg');">
      <div class="banner-content">
        <div class="banner-title">HISTORIA E IDENTIDAD NACIONAL</div>
        <div class="banner-subtitle">Consulta de Lista de Aprobados</div>
      </div>
    </div>
    
    <h2>CTMOR M√≥dulos Transversales<BR/><BR/>Consulta de ‚úÖ Listado de Aprobados<BR/>M√≥dulo: HISTORIA E IDENTIDAD NACIONAL</h2>
    --------------------------------------------------------------------------------<BR/>
    
    <form id="form-codigo">
      <label for="codigo">INGRESE EL CODIGO DE ACCESO:</label>
      <input name="codigo" type="text" id="codigo" required autofocus placeholder="Ej. 676629" />
      <input type="submit" value="Ver lista" />
    </form>
    --------------------------------------------------------------------------------<BR/>
    
    <div id="tabla-encabezado" style="display:none;">
      <table class="header-table">
        <tr><td colspan="2" class="left-aligned-combined">CTMOR - M√≥dulos Transversales SAB & DOM</td></tr>
        <tr><td class="header-label">C√≥digo:</td><td class="header-value" id="enc-codigo"></td></tr>
      </table>
    </div>

    <div id="resultado"></div>

    <BR/><BR/>M√°s Informaci√≥n<BR/>Prof. Leonardo D√°vila<BR/> Whatsapp: 84489492
    <BR/><BR/>
    <BR/><i>"Encomienda al Se√±or tus planes y tus pensamientos ser√°n afirmados"</i>
    <BR/><i>Proverbios 16:3</i>
  </div>

  <script>
    // --- CONFIGURA AQU√ç tu CSV p√∫blico de Google Sheets ---
    const sheetCSV = 'https://docs.google.com/spreadsheets/d/<TU_SHEET_ID>/export?format=csv&gid=0';

    function getQueryParam(param) {
      const params = new URLSearchParams(window.location.search);
      return params.get(param);
    }

    async function mostrarCodigo(event) {
      if(event) event.preventDefault(); // previene el submit del formulario
      const codigoParam = getQueryParam("codigo") || document.getElementById("codigo").value.trim();
      if (!codigoParam) {
        document.getElementById("resultado").innerHTML = "<p class='info-message'>No se indic√≥ ning√∫n c√≥digo.</p>";
        return;
      }

      // Cargar CSV
      const resp = await fetch(sheetCSV);
      const text = await resp.text();
      const rows = text.split("\n").map(r => r.split(","));

      const headers = rows[0];
      const codigoIdx = headers.indexOf("CODIGO");
      const estudianteIdx = headers.indexOf("ESTUDIANTES");
      const estadoIdx = headers.indexOf("ESTADO");

      const resultados = rows.slice(1).filter(r => r[codigoIdx] === codigoParam);

      const div = document.getElementById("resultado");
      const tablaEncabezado = document.getElementById("tabla-encabezado");

      if (resultados.length === 0) {
        div.innerHTML = "<p class='info-message'>No se encontraron alumnos para este c√≥digo.</p>";
        tablaEncabezado.style.display = "none";
        return;
      }

      document.getElementById("enc-codigo").textContent = resultados[0][codigoIdx];
      tablaEncabezado.style.display = "table";

      // Tabla de resultados
      let html = `<table class="responsive-table">
        <thead><tr><th>Estudiante</th><th>Estado</th></tr></thead><tbody>`;

      resultados.forEach(r => {
        let clase = r[estadoIdx].includes("APROBADO") ? "fila-aprobado" : "fila-pendiente";
        let estadoEmoji = r[estadoIdx].includes("APROBADO") ? "‚úÖ" : "üî∫";
        html += `<tr class="${clase}">
          <td data-label="Estudiante">${r[estudianteIdx]}</td>
          <td data-label="Estado">${estadoEmoji} ${r[estadoIdx]}</td>
        </tr>`;
      });

      html += "</tbody></table>";
      div.innerHTML = html;
    }

    // Ejecutar al cargar la p√°gina si viene el par√°metro en URL
    window.onload = mostrarCodigo;

    // Asociar formulario
    document.getElementById("form-codigo").addEventListener("submit", mostrarCodigo);
  </script>
</body>
</html>
